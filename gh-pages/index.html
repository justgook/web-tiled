<!DOCTYPE html>
<html lang="en">

<head>

    <title>Web Tiled</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/photon.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/progress.css">
    <style>
        body {
            background-image: /* tint image */ linear-gradient(to right, rgba(192, 192, 192, 0.75), rgba(192, 192, 192, 0.75)),
                /* checkered effect */ linear-gradient(to right, black 50%, white 50%),
            linear-gradient(to bottom, black 50%, white 50%);
            background-blend-mode: normal, difference, normal;
            background-size: 2em 2em;
        }

        .vResize, .hResize {
            position: relative;
            z-index: 1;
        }

        .vResize::after, .hResize::after {
            /*background: rgba(0, 100, 0, 0.4);*/
            position: absolute;
            content: "";
        }

        .vResize::after {
            top: -5px;
            right: 0;
            bottom: -5px;
            left: 0;
        }

        .hResize::after {
            top: 0;
            right: -5px;
            bottom: 0;
            left: -5px;
        }

        canvas, img, image {
            image-rendering: optimizeSpeed; /* Older versions of FF */
            image-rendering: -moz-crisp-edges; /* FF 6.0+ */
            image-rendering: -webkit-optimize-contrast; /* Safari */
            image-rendering: -o-crisp-edges; /* OS X & Windows Opera (12.02+) */
            image-rendering: pixelated; /* Awesome future-browsers*/
            -ms-interpolation-mode: nearest-neighbor; /* IE */
        }

        input {
            padding: 0;
            margin: 0;

            border: none;
            display: inline;
            box-sizing: border-box;
            min-width: 100%;

            outline-offset: 0;
            background: transparent;
            transition-property: background-color;
            transition-timing-function: cubic-bezier(0.4, 0.0, 1, 1);
            transition-duration: 0.2s
        }

        input:focus {
            transition-timing-function: cubic-bezier(0.0, 0.0, 0.2, 1);
            transition-duration: 0.25s;
            background-color: #ccc;
        }

        input:active {
            background: transparent;
            outline-color: transparent;
        }

        :focus {
            outline: none;
        }

        :active, :active td {
            transition: background-color 0.25s, color 0s;
            transition-timing-function: cubic-bezier(0.0, 0.0, 0.2, 1);

        }

        :active tr {
            transition-delay: 0.4s;
        }

        :active tr.no-delay {
            transition-delay: 0s;
        }


    </style>
    <script src="./script.js"></script>
    <posthtml-head-elements>
        <script src="./bundle.js"></script>
        <!--        <script src="https://unpkg.com/elm-debug-transformer@0.0.7/dist/elm-console-debug.js"></script>-->
        <!--        <script>ElmConsoleDebug.register()</script>-->
    </posthtml-head-elements>


</head>

<body>

<script>
    var redirect = sessionStorage.redirect;
    delete sessionStorage.redirect;
    if (redirect && redirect !== location.href) {
        history.replaceState(null, null, redirect);
    }

    document.addEventListener("dragover", function (event) {
        event.preventDefault();
    }, false);
    document.addEventListener("drop", function (event) {
        event.preventDefault();
    }, false);

    document.body.addEventListener("dragstart", event => {
        if (event.target && event.target.draggable) {
            event.dataTransfer.setData("text/html", "blank");
        }
    });

    document.body.addEventListener("dragover", event => {
        // this is needed in order to make dragging work
        return false;
    });
    //TODO add filtering for specific keys - like `⌘S` `⌘R`
    // document.body.addEventListener("keydown", event => {
    //     event.preventDefault();
    //     // event.stopPropagation();
    // }, false);


    const defaultConfig = { file: "hello.json" };
    initRemoteStorage().then((remoteStorage) => {
        const { api } = remoteStorage;
        api.getConfig(defaultConfig).then(() => {
                const flags = {
                    version: "1.3.0",
                    levelUrl: getParameterByName("url") || "top-down-adventure/demo.json"
                };

                const app = Object.values(Elm)[0].init({
                    node: document.querySelector("main"),
                    flags: flags
                });
                console.log(app.ports);
                // createWidget(remoteStorage);
                // api.rpc(app.ports.toStore.subscribe, app.ports.fromStore.send);
            }
        );
    });
    function getParameterByName(name) {
        var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
        return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
    }

</script>

</body>

</html>
